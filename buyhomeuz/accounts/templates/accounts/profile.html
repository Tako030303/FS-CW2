{% extends 'base.html' %} {% block title %}User Profile{% endblock %} 
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-10 mb-3">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">My Profile</h4>
      </div>
      <div class="card-body">
        <div class="row mb-4">
          <div class="col-md-4 text-center">
            <i class="bi bi-person-circle display-1 text-secondary"></i>
            <h3 class="mt-3">{{ user.first_name }} {{ user.last_name }}</h3>
          </div>
          <div class="col-md-8">
            <h5 class="border-bottom pb-2 mb-3">Account Information</h5>

            <div class="row mb-2">
              <div class="col-sm-4 text-muted">Username</div>
              <div class="col-sm-8 fw-bold">{{ user.username }}</div>
            </div>

            <div class="row mb-2">
              <div class="col-sm-4 text-muted">Email</div>
              <div class="col-sm-8">
                {% if user.email %} {{ user.email }} {% else %}
                <span class="text-muted">No email provided</span>
                {% endif %}
              </div>
            </div>

            <div class="row mb-0">
              <div class="col-sm-4 text-muted">Group</div>
              <div class="col-sm-8">
                {% if user.groups.all %} {% for group in user.groups.all %}
                <span class="badge bg-info text-dark me-1"
                  >{{ group.name }}</span
                >
                {% endfor %} {% else %}
                <span class="text-muted">No groups assigned</span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% if not perms.auth.change_appointment %}
  <div class="col-md-10 mb-3">
    <div class="card shadow-sm">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">My Appointments</h5>
      </div>
      <div class="card-body">
        {% if user_appointments %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Property</th>
                <th>Date & Time</th>
                <th>Status</th>
                <th>Manager</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for appointment in user_appointments %}
              <tr>
                <td>
                  <a
                    href="{% url 'properties:details' appointment.property.pk %}"
                  >
                    {{ appointment.property.title }}
                  </a>
                </td>
                <td>{{ appointment.start_time|date:"M d, Y - g:i A" }}</td>
                <td>
                  {% if appointment.status == 'pending' %}
                  <span class="badge bg-warning text-dark">Pending</span>
                  {% elif appointment.status == 'accepted' %}
                  <span class="badge bg-success">Accepted</span>
                  {% elif appointment.status == 'denied' %}
                  <span class="badge bg-danger">Denied</span>
                  {% elif appointment.status == 'cancelled' %}
                  <span class="badge bg-secondary">Cancelled</span>
                  {% elif appointment.status == 'completed' %}
                  <span class="badge bg-primary">Completed</span>
                  {% endif %}
                </td>
                <td>
                  {% if appointment.manager %} {{ appointment.manager.username}} {% else %}
                  <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td>
                  {% if appointment.status == 'pending' or appointment.status == 'accepted' %}
                  <a href="{% url 'appointments:cancel' appointment.pk %}" class="btn btn-sm btn-danger"> Cancel </a>
                  {% else %}
                  <span class="text-muted">-</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">You dont have any appointments.</p>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}

  {% if perms.auth.change_appointment %}
  <div class="col-md-10 mb-3">
    <div class="card shadow-sm">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">My Appointments</h5>
      </div>
      <div class="card-body">
        {% if manager_appointments %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Property</th>
                <th>Date & Time</th>
                <th>Status</th>
                <th>Customer</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for appointment in manager_appointments %}
              <tr>
                <td>
                  <a
                    href="{% url 'properties:details' appointment.property.pk %}"
                  >
                    {{ appointment.property.title }}
                  </a>
                </td>
                <td>{{ appointment.start_time|date:"M d, Y - g:i A" }}</td>
                <td>
                  {% if appointment.status == 'pending' %}
                  <span class="badge bg-warning text-dark">Pending</span>
                  {% elif appointment.status == 'accepted' %}
                  <span class="badge bg-success">Accepted</span>
                  {% elif appointment.status == 'denied' %}
                  <span class="badge bg-danger">Denied</span>
                  {% elif appointment.status == 'cancelled' %}
                  <span class="badge bg-secondary">Cancelled</span>
                  {% elif appointment.status == 'completed' %}
                  <span class="badge bg-primary">Completed</span>
                  {% endif %}
                </td>
                <td>
                  {% if appointment.manager %} {{ appointment.customer.username}} {% else %}
                  <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td>
                  {% if appointment.status == 'pending' or appointment.status == 'accepted' %}
                  <a href="{% url 'appointments:cancel' appointment.pk %}" class="btn btn-sm btn-danger"> Cancel </a>
                  {% else %}
                  <span class="text-muted">-</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">You dont have any appointments.</p>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}
  {% if perms.appointments.change_appointment %}
  <div class="col-md-10">
    <div class="card shadow-sm border-warning">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">Pending Appointments</h5>
      </div>
      <div class="card-body">
        {% if pending_appointments %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Customer</th>
                <th>Property</th>
                <th>Requested Date & Time</th>
                <th>Customer Note</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for appointment in pending_appointments %}
              <tr>
                <td>{{ appointment.customer.username }}</td>
                <td>
                  <a
                    href="{% url 'properties:details' appointment.property.pk %}"
                  >
                    {{ appointment.property.title }}
                  </a>
                </td>
                <td>{{ appointment.start_time|date:"M d, Y - g:i A"}}</td>
                <td>
                  {% if appointment.customer_note %}
                  {{appointment.customer_note|truncatewords:10 }} {% else %}
                  <span class="text-muted">No note</span>
                  {% endif %}
                </td>
                <td>
                  <div class="btn-group btn-group-sm" role="group">
                    <a href="{% url 'appointments:update_status' appointment.pk 'accepted' %}" class="btn btn-success">Accept</a>
                    <a href="{% url 'appointments:update_status' appointment.pk 'denied' %}" class="btn btn-danger">Deny</a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">No pending appointments.</p>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
